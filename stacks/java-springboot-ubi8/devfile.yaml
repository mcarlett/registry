schemaVersion: 2.0.0
metadata:
  name: java-springboot-ubi8
  version: 0.0.1
  displayName: Spring Boot® Java ubi8
  description: Spring Boot® with Java and ubi8 image
  icon: https://raw.githubusercontent.com/devfile-samples/devfile-stack-icons/main/java-maven.jpg
  tags: ['Java', 'Spring']
  projectType: 'spring'
  language: 'java'
components:
  - name: tools
    container:
      image: registry.access.redhat.com/ubi8/openjdk-11
      memoryLimit: 512Mi ## default app nowhere needs this but leaving room for expansion.
      mountSources: true
      volumeMounts:
        - name: mvnrepo
          path: /home/jboss/.m2/repository
    endpoints:
    - name: http-8778
      targetPort: 8778
    - name: http-8080
      targetPort: 8080
    - name: http-8443
      targetPort: 8443
    env:
      - name: PROJECTS_ROOT
        value: '/tmp/src'
  - name: mvnrepo
    volume:
      size: 1Gi
commands:
  - id: init-compile
    exec:
      component: tools
      commandLine: '/usr/local/s2i/assemble'
      workingDir: $PROJECTS_ROOT
  - id: dev-run
    exec:
      component: tools
      commandLine: '/usr/local/s2i/run'
      hotReloadCapable: true
      group:
        kind: run
        isDefault: true
      workingDir: $PROJECTS_ROOT
  - id: dev-debug
    exec:
      component: tools
      commandLine: '/usr/local/s2i/run'
      hotReloadCapable: true
      env:
        - name: JAVA_DEBUG
          value: 'true'
        - name: JAVA_DEBUG_PORT
          value: ${DEBUG_PORT}
      group:
        kind: debug
        isDefault: true
      workingDir: $PROJECTS_ROOT
events:
  postStart:
    - init-compile
